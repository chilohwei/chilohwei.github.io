{% if site.showBuyCoffee != false %}
<div class="coffee" style="text-align: center; margin-bottom: 30px;">
    <a class="buy-me-coffee" href="#" onclick="togglePaymentCodes(); return false;">
        {% if page.lang == 'en-US' %}
        Like the articleâ¤ï¸
        {% else %}
        å–œæ¬¢æ–‡ç«  â†’ èµèµæˆ‘â¤ï¸
        {% endif %}
    </a>
</div>
<div id="payment-codes" style="display:none; text-align: center; margin-top: 20px;">
    <div style="display: inline-block; vertical-align: top; margin: 0 10px; max-width: 30%;">
        <img src="https://chilohdata.s3.bitiful.net/wechat.png?x-oss-process=image/resize,w_200" 
             data-original="https://chilohdata.s3.bitiful.net/wechat.png" 
             alt="å¾®ä¿¡æ”¯ä»˜" 
             class="qr-payment-img" 
             style="width: 100%; height: auto; max-width: 180px; cursor: zoom-in;">
        <p style="margin-top: 10px; color: #555; font-size: 0.9em; font-weight: 500;">ğŸ’š å¾®ä¿¡æ”¯ä»˜</p>
    </div>
    <div style="display: inline-block; vertical-align: top; margin: 0 10px; max-width: 30%;">
        <img src="https://chilohdata.s3.bitiful.net/zfb.png?x-oss-process=image/resize,w_200" 
             data-original="https://chilohdata.s3.bitiful.net/zfb.png" 
             alt="æ”¯ä»˜å®" 
             class="qr-payment-img" 
             style="width: 100%; height: auto; max-width: 180px; cursor: zoom-in;">
        <p style="margin-top: 10px; color: #555; font-size: 0.9em; font-weight: 500;">ğŸ’™ æ”¯ä»˜å®</p>
    </div>
</div>

<!-- ä¼˜åŒ–çš„äºŒç»´ç å¤§å›¾æŸ¥çœ‹å™¨ -->
<div id="qr-image-viewer" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.92); z-index: 9999; cursor: zoom-out; backdrop-filter: blur(8px);" onclick="closeQRViewer()">
    <!-- å±…ä¸­å®¹å™¨ -->
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; justify-content: center; max-width: 90vw; max-height: 90vh;">
        <!-- äºŒç»´ç å›¾ç‰‡å®¹å™¨ -->
        <div style="background: white; padding: 30px; border-radius: 16px; box-shadow: 0 20px 80px rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center;">
            <img id="qr-viewer-img" src="" alt="äºŒç»´ç " style="display: block; width: auto; height: auto; max-width: min(500px, 70vw); max-height: min(500px, 70vh); object-fit: contain;">
        </div>
        <!-- æç¤ºæ–‡å­— -->
        <div style="margin-top: 24px; color: white; font-size: 15px; text-align: center; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5); line-height: 1.6;">
            <div style="font-weight: 500; margin-bottom: 8px;">ğŸ“± è¯·ç”¨æ‰‹æœºæ‰«æäºŒç»´ç </div>
            <div style="font-size: 13px; opacity: 0.85;">ç‚¹å‡»ä»»æ„ä½ç½®æˆ–æŒ‰ ESC é”®å…³é—­</div>
        </div>
    </div>
</div>
{% endif %}

<script>
function togglePaymentCodes() {
    var paymentCodesDiv = document.getElementById('payment-codes');
    if (paymentCodesDiv.style.display === 'none') {
        paymentCodesDiv.style.display = 'block';
        // æ·»åŠ å›¾ç‰‡ç‚¹å‡»äº‹ä»¶ç›‘å¬
        setTimeout(() => {
            const qrImages = document.querySelectorAll('.qr-payment-img');
            qrImages.forEach(img => {
                img.onclick = function(e) {
                    e.stopPropagation();
                    showQRViewer(this);
                };
            });
        }, 100);
    } else {
        paymentCodesDiv.style.display = 'none';
    }
}

function showQRViewer(imgElement) {
    const viewer = document.getElementById('qr-image-viewer');
    const viewerImg = document.getElementById('qr-viewer-img');
    // ä½¿ç”¨åŸå§‹å¤§å›¾åœ°å€ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨å½“å‰å›¾ç‰‡åœ°å€
    const originalSrc = imgElement.dataset.original || imgElement.src.split('?')[0];
    // ä½¿ç”¨ dpr=0.5 è¿›è¡Œ 50% ç­‰æ¯”ç¼©æ”¾ï¼Œä¸è£å‰ª
    // ä¸æŒ‡å®š w/hï¼Œç›´æ¥ä½¿ç”¨ dpr å¯¹åŸå›¾è¿›è¡Œç¼©æ”¾
    const scaledSrc = originalSrc + '?dpr=0.5';
    viewerImg.src = scaledSrc;
    viewer.style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function closeQRViewer() {
    const viewer = document.getElementById('qr-image-viewer');
    viewer.style.display = 'none';
    document.body.style.overflow = '';
}

// ESC é”®å…³é—­
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeQRViewer();
    }
});
</script>

<style>
.qr-payment-img {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 8px;
}

.qr-payment-img:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

#qr-image-viewer {
    animation: fadeIn 0.25s ease-out;
}

#qr-image-viewer > div {
    animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes scaleIn {
    from {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
    }
    to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    #payment-codes > div {
        max-width: 45% !important;
        margin: 0 5px !important;
    }
    
    #qr-viewer-img {
        max-width: min(400px, 80vw) !important;
        max-height: 60vh !important;
    }
    
    #qr-image-viewer > div > div {
        padding: 20px !important;
    }
}

/* å°å±å¹•ä¼˜åŒ– */
@media (max-width: 480px) {
    #qr-viewer-img {
        max-width: min(300px, 85vw) !important;
        max-height: 55vh !important;
    }
    
    #qr-image-viewer > div > div {
        padding: 15px !important;
    }
}
</style>