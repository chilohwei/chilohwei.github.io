function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","Windows Phone","iPad","iPod"],n=!0,i=0;i<t.length;i++)if(e.indexOf(t[i])>0){n=!1;break}return n}function loadScript(e,t){var n=document.createElement("script");n.type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t())}:n.onload=function(){t()},n.src=e,document.body.appendChild(n)}function initCodeBlocks(){document.querySelectorAll(".highlighter-rouge").forEach(function(e){var t=e.querySelector(".highlight");if(t){for(var n="",i=e.className.split(" "),a=0;a<i.length;a++)if(0===i[a].indexOf("language-")){n=i[a].replace("language-","");break}if(n){var r=document.createElement("span");r.className="code-lang",r.textContent=n,t.insertBefore(r,t.firstChild)}var o=t.querySelector("pre code");if(o){var c=o.innerHTML;c=(c=c.replace(/^(\s*<[^>]*>\s*)*\n/,"")).replace(/\n(\s*<[^>]*>\s*)*$/,""),o.innerHTML=c}t.classList.add("wrap-enabled");var s=document.createElement("button");s.className="copy-btn",s.textContent="Copy",s.setAttribute("aria-label","Copy code to clipboard"),s.addEventListener("click",function(){var e=t.querySelector("pre");if(e){var n=e.textContent||e.innerText;n=n.trim(),navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(function(){showCopied(s)}).catch(function(){fallbackCopy(n,s)}):fallbackCopy(n,s)}}),t.appendChild(s)}})}function showCopied(e){e.textContent="Copied!",e.classList.add("copied"),setTimeout(function(){e.textContent="Copy",e.classList.remove("copied")},2e3)}function fallbackCopy(e,t){var n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select();try{document.execCommand("copy"),showCopied(t)}catch(e){t.textContent="Failed"}document.body.removeChild(n)}function initLinkPreviews(){var e=document.querySelectorAll(".entry-content, .page-content, article.hentry > .entry-content");e.length&&e.forEach(function(e){e.closest(".header-href")||processLinksInContainer(e)})}function processLinksInContainer(e){e.querySelectorAll("p").forEach(function(e){var t=e.innerHTML.trim(),n=e.querySelector("a");if(n&&t===n.outerHTML){var i=n.href,a=n.textContent||n.innerText;if(i&&!i.startsWith("#")&&!i.startsWith("mailto:")){try{if(new URL(i).hostname===window.location.hostname)return}catch(e){return}var r=createLinkPreviewCard(i,a,null,null,null);e.parentNode.replaceChild(r,e),fetchLinkPreview(i,r,a)}}})}function fetchLinkPreview(e,t,n){var i="https://api.microlink.io?url="+encodeURIComponent(e);fetch(i).then(function(e){return e.json()}).then(function(i){if("success"===i.status&&i.data){var a=i.data;updateLinkPreviewCard(t,e,a.title||n,a.description||"",a.image?a.image.url:null,a.logo?a.logo.url:null)}}).catch(function(e){console.warn("Link preview fetch failed:",e)})}function createLinkPreviewCard(e,t,n,i,a){var r=document.createElement("a");r.href=e,r.className="link-preview",r.target="_blank",r.rel="noopener noreferrer";var o="",c="";try{o=new URL(e).hostname.replace("www.",""),c=a||"https://www.google.com/s2/favicons?domain="+o+"&sz=32",("github.com"===o||o.endsWith(".github.com"))&&r.classList.add("link-preview-github")}catch(t){o=e}var s=t,l=n||"";if(!l)for(var d=[" - ",": "," | "],h=0;h<d.length;h++){var u=t.indexOf(d[h]);if(u>0&&u<t.length-d[h].length){s=t.substring(0,u),l=t.substring(u+d[h].length);break}}var m='<div class="link-preview-content">';return m+='<div class="link-preview-text">',m+='<div class="link-preview-title">'+escapeHtml(s)+"</div>",l&&(m+='<div class="link-preview-description">'+escapeHtml(l)+"</div>"),m+='<div class="link-preview-meta">',m+='<img class="link-preview-favicon" src="'+escapeHtml(c)+'" alt="" onerror="this.style.display=\'none\'">',m+='<span class="link-preview-domain">'+escapeHtml(o)+"</span>",m+="</div>",m+="</div>",i&&(m+='<div class="link-preview-image" style="background-image: url(\''+escapeHtml(i)+"')\"></div>"),m+="</div>",r.innerHTML=m,r}function updateLinkPreviewCard(e,t,n,i,a,r){var o="",c="";try{o=new URL(t).hostname.replace("www.",""),c=r||"https://www.google.com/s2/favicons?domain="+o+"&sz=32"}catch(e){o=t}var s='<div class="link-preview-content">';s+='<div class="link-preview-text">',s+='<div class="link-preview-title">'+escapeHtml(n)+"</div>",i&&(s+='<div class="link-preview-description">'+escapeHtml(i)+"</div>"),s+='<div class="link-preview-meta">',s+='<img class="link-preview-favicon" src="'+escapeHtml(c)+'" alt="" onerror="this.style.display=\'none\'">',s+='<span class="link-preview-domain">'+escapeHtml(o)+"</span>",s+="</div>",s+="</div>",a&&(s+='<div class="link-preview-image" style="background-image: url(\''+escapeHtml(a)+"')\"></div>"),s+="</div>",e.innerHTML=s}function escapeHtml(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".entry-content img");if(e&&e.length>0&&(e.forEach(function(e){var t=e.getAttribute("alt"),n=e.parentElement;if(t&&"FIGURE"!==n.tagName&&"A"!==n.tagName&&!t.toLowerCase().includes("qr code")){var i=document.createElement("figure");i.className="image-figure";var a=document.createElement("figcaption");a.textContent=t,"P"===n.tagName&&1===n.childNodes.length?(n.parentNode.insertBefore(i,n),i.appendChild(e),i.appendChild(a),n.parentNode.removeChild(n)):(n.insertBefore(i,e),i.appendChild(e),i.appendChild(a))}}),e=document.querySelectorAll(".entry-content img"),loadScript("https://gw.alipayobjects.com/os/k/s3/lightense.min.js",function(){Lightense&&Lightense(e,{background:"rgba(0, 0, 0, 0.9)",padding:40,offset:40})})),initCodeBlocks(),initLinkPreviews(),isPC()){var t=document.documentElement.scrollTop;document.addEventListener("scroll",function(){var e=document.documentElement.scrollTop,n=e-t;document.getElementById("J_header").setAttribute("class",n>0&&e>0?"header-menu header-menu-overflow":"header-menu"),t=e},{passive:!0});var n=window.innerWidth,i=document.getElementById("J_firework_canvas");if(i){i.width=n,i.height=260;var a=i.getContext("2d",{alpha:!0}),r=[],o=!0,c={x:0,y:9999};if("IntersectionObserver"in window)new IntersectionObserver(function(e){e.forEach(function(e){o=e.isIntersecting})},{threshold:0}).observe(i);window.matchMedia("(prefers-reduced-motion: reduce)").matches||function e(){if(o){if(a.clearRect(0,0,i.width,i.height),c.y<260)for(var t=0;t<5;t++){var n=c.x+10*Math.random(),s=c.y+10*Math.random();r.push(new l(n,s,1+2*Math.random(),5,"white"))}for(var t in r)r[t].active&&(r[t].draw(),r[t].physx());requestAnimationFrame(e)}else requestAnimationFrame(e)}(),document.onmousemove=function(e){c.x=e.pageX,c.y=e.pageY},document.onmouseout=function(e){c.x=0,c.y=9999};var s=document.getElementById("J_qr_text");s&&s.offsetParent&&loadScript("https://gw.alipayobjects.com/os/k/qa/qrcode.min.js",function(){QRCode&&new QRCode(document.getElementById("J_qr_code"),{width:128,height:128,useSVG:!0,text:window.location.href,correctLevel:QRCode.CorrectLevel.L})})}}function l(e,t,n,o,c){this.x=e,this.y=t,this.width=o,this.color=c,this.alpha=Math.random()-.1,this.speed=n,this.active=!0,this.physx=function(){this.y+=this.speed,this.y>i.height&&this.kill()},this.kill=function(){r.splice(r.indexOf(this),1),this.active=!1},this.draw=function(){a.beginPath(),a.arc(this.x,this.y,this.width,0,2*Math.PI,!0),a.fillStyle=this.color,a.lineWidth=this.width,a.save(),a.globalAlpha=this.alpha,a.fill(),a.restore()}}},!1);